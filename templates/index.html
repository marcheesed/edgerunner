<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8">
<title>dashboard</title>
<!-- this is the styling for the page-->
<link rel="stylesheet" href="https://unpkg.com/98.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<!-- this is the icon -->
<link rel="icon" href="https://file.garden/aBi0tvXzESnPXzr_/tumblr_051dccd31c15cc361f0f97ee3a647c1c_dcf1f018_250.png" type="image/png">
</head>
<body>

<!-- this is heavily python backended though contains some javascript and html/css -->
<!-- i made it for fun in a day and will likely keep developing this -->
<!-- it is free to use and on github. yay -->



<!-- this is where the full container is init'd using the css library -->
<div class="window" style="max-width: 600px; margin: 40px auto;">
  <div class="title-bar">
    <div class="title-bar-text">my dashboard</div>
    <div class="title-bar-controls">
      <button class="minimize"></button>
      <button class="maximize"></button>
      <button class="close"></button>
    </div>
  </div>

<!-- this is where the window body begins -->

<div class="window-body">
  <section class="group-box" style="text-align: center;">
    <img src="https://file.garden/aBi0tvXzESnPXzr_/lucy_smoke" style="border-radius:3px; max-width:40%; height:auto; margin-bottom:10px;" class="image" alt="dashboard image">
    <p><strong>time & date:</strong> <span id="time">{{ time }}</span></p>
    <p><strong>weather:</strong> <span id="weather">{{ weather }}</span></p>
    <blockquote>"{{ quote }}"</blockquote>
  </section>

  <hr>
<!-- text -->
<div class="main-text">
{% if tarot.card or feeling.character or last_updated.date %}
      <p>likely a temporary hub to remind me to do a lot of this stuff.</p>
      <p>my name is marcy or angel or whatever you wanna call me, it/they, 19yo, knowledgeable in html/css & python.  </p>
      <p>i am not volunteering for anything unless i state otherwise, <a href="https://raincandy.lol/portfolio">check more here.</a>  </p>
      <p>i am currently undergoing multiple mental health issues, personal irl situations, etc. all bad things happening at once. i'm trying to be patient and do my best, but if i snap or act unusually, i'm very sorry.</p>
      <p>despite this, i try to be friendly especially to others in bad situations. <strong>do not flirt with me if you are under 18</strong></p>

<!-- this is where the output for the tarot card, character feeling and last update go -->
    {% if tarot.card %}
      <p><strong>today's tarot card:</strong> {{ tarot.card }} ----
    {% endif %}
    {% if feeling.character %}
      <strong>today i feel like:</strong> {{ feeling.character }} ----
    {% endif %}
    {% if last_updated.date %}
      <strong>last updated on:</strong> {{ last_updated.date }}</p>
    {% endif %}
{% endif %}
  </section>
</div>
  <hr>

  <section class="group-box">
    <h4 style="text-align:center;">to-do list</h4>
<!-- this is the add task forum -->
<div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; margin-bottom:10px;">
  <form method="post" style="display:flex; gap:5px; align-items:center;">
    <input id="task" name="task" type="text" placeholder="new task" style="width:150px; min-width:150px; max-width:300px;">
    <input type="hidden" name="form_type" value="todo">
    <button type="submit" class="btn">add task</button>
  </form>
<!-- this gives you the option to enter your password, and shows logout if you're logged in -->
{% if not session.get('password') %}
  <button type="button" id="passwordBtn" class="btn" style="padding: 8px 15px; min-width: 80px;">enter password</button>
{% else %}
  <form action="{{ url_for('logout') }}" method="get" style="display:inline-flex;">
    <button type="submit" class="btn" style="width:80px;">logout</button>
  </form>
  {% endif %}

<!-- this is an accessibility feature and turns off the background -->
<form action="" method="post">
  <button type="submit" name="action" value="toggle-bg" data-theme-toggle aria-label="turn off background giff" style="padding: 8px 15px; min-width: 80px;">
    turn off background gif
  </button>
</form>
</div>


<hr>
    </div>
<!-- this is where we init the buttons for tasks -->
    <ul style="list-style:none; padding-left:0; margin-top:10px; max-width:500px; margin-left:auto; margin-right:auto;">
      {% for todo in todos %}
      <li style="margin:6px 0; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:5px;">
        <span style="flex:1; word-break:break-word;" class="{% if todo.done %}done{% endif %}">{{ todo.task }}</span>
        <div style="display:flex; gap:5px;">
          <form method="post" action="{{ url_for('toggle', index=loop.index0) }}">
            <button type="submit" {% if not session.get('password') %}disabled title="enter password to unlock"{% endif %}>✔</button>
          </form>
          <form method="post" action="{{ url_for('delete', index=loop.index0) }}">
            <button type="submit" {% if not session.get('password') %}disabled title="enter password to unlock"{% endif %}>❌</button>
          </form>
        </div>
      </li>
      {% endfor %}
    </ul>
  </section>

  <hr>
<!-- this means only a user who is logged in can see this part -->
  {% if session.get('password') %}
<details>
  <!-- editing quotes -->
  <summary style="cursor:pointer; font-weight:bold; text-align:left; padding-left: 10px;">edit quote roster</summary>
  <div style="display:flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
    {% for q in quotes %}
    <form action="{{ url_for('quotes') }}" method="post" style="display:flex; gap:5px; flex: 1 0 200px; min-width: 200px;">
      <input type="hidden" name="index" value="{{ loop.index0 }}">
      <input type="text" name="quote" value="{{ q }}" style="min-width: 135px; max-width: 180px;">
      <button name="action" value="edit">save</button>
      <button name="action" value="delete">delete</button>
    </form>
    {% endfor %}
  </div>
  <form action="{{ url_for('quotes') }}" method="post" style="margin-top: 10px; display:flex; gap:5px; align-items:center;">
    <input type="text" name="quote" placeholder="new quote" style="min-width: 180px; max-width: 180px;">
    <button name="action" value="add">add quote</button>
  </form>
</details>

<hr>
<details>
  <!-- editing tarot, character feeling and last updated -->
  <summary style="cursor:pointer; font-weight:bold; text-align:right; padding-right: 10px;">edit tarot card, character feeling & last updated</summary>
  <section class="group-box" style="margin-top:10px;">
    <div style="display:flex; flex-direction: column; gap: 10px; align-items: flex-end;">
      <form method="post" style="display:flex; gap:5px; align-items:center; flex-wrap: wrap;">
        <input type="text" name="card" placeholder="today's tarot card" style="min-width:200px; max-width:250px;">
        <input type="hidden" name="form_type" value="tarot">
        <button type="submit" class="btn" style="width:100px;">set tarot</button>
      </form>
      <form method="post" style="display:flex; gap:5px; align-items:center; flex-wrap: wrap;">
        <input type="text" name="character" placeholder="character name" style="min-width:200px; max-width:250px;">
        <input type="hidden" name="form_type" value="feeling">
        <button type="submit" class="btn" style="width:100px;">set feeling</button>
      </form>
      <form method="post" action="{{ url_for('set_last_updated') }}" style="display:flex; gap:5px; align-items:center;">
      <input type="text" name="last_date" placeholder="last updated on" value="{{ last_updated.date or '' }}" style="width:200px;">
      <button type="submit" class="btn" style="width:100px;">set last updated</button>
    </form>
    </div>
  </section>
</details>


<hr>
{% endif %}

<!-- this is the tarot history -->
  <div style="display:flex">
  <div style="text-align:left; padding-left: 10px;">
<h4>tarot history</h4>
<ul>
  {% for entry in tarot_history %}
    <li>{{ entry.date }} — {{ entry.card }}</li>
  {% endfor %}
</ul>
</div>
<hr>
<img src="https://file.garden/aBi0tvXzESnPXzr_/db7903c43d1659892f9e7eb985ca92ec.jpg" style="width: 30%; border-radius: 5px; margin-right: 10px;">
</div>

<hr>

<!-- this is the bottom footer with social media buttons -->
  <div class="social-buttons" style="padding-bottom: 10px;">
    <form action="{{ url_for('extras') }}" method="get" target="_blank">
      <button type="submit" class="btn">funky extras</button>
    </form>
    <form action="{{ url_for('art') }}" method="get" target="_blank">
      <button type="submit" class="btn">art archive</button>
    </form>
    <form action="{{ url_for('links') }}" method="get" target="_blank">
      <button type="submit" class="btn">links hub</button>
    </form>
    <form action="https://raincandy.lol" method="get" target="_blank">
      <button type="submit" class="btn">main website</button>
    </form>
  </div>
</div>
</div>


<!-- this is the password prompt -->

<div id="modaloverlay"></div>
<div id="passwordmodal" class="window">
  <div class="title-bar">
    <div class="title-bar-text">enter password</div>
    <div class="title-bar-controls">
      <button class="close" id="closeModal"></button>
    </div>
  </div>
  <div class="window-body">
    <form method="post" action="{{ url_for('set_password') }}">
      <input type="password" name="password" placeholder="password">
      <button type="submit">ok</button>
    </form>
  </div>
</div>
<style>

:root[data-theme="light"] {
  --background-image: url("https://file.garden/aBi0tvXzESnPXzr_/tumblr_9dfe98f9048343554fc179782ea63bbf_d64953fc_250.webp");
}

:root[data-theme="dark"] {
  --background-image: rgb(4, 3, 37);
}


body {
    background: var(--background-image);
}



</style>
<script>
  // should be an auto refresh for the time along with theme for the background gif toggle.
async function updateStatus() {
  try {
    const response = await fetch("/api/status");
    const data = await response.json();
    document.getElementById("time").textContent = data.time;
    document.getElementById("weather").textContent = data.weather;
  } catch(err){console.error(err);}
}
setInterval(updateStatus,30000);
updateStatus();

const modal = document.getElementById('passwordmodal');
const overlay = document.getElementById('modaloverlay');
const btn = document.getElementById('passwordBtn');
const close = document.getElementById('closeModal');
function showModal(){ modal.style.display='block'; overlay.style.display='block'; }
function closeModal(){ modal.style.display='none'; overlay.style.display='none'; }
if(btn) btn.onclick=showModal;
close.onclick=closeModal;
overlay.onclick=closeModal;
</script>
<script>
function calculateSettingAsThemeString({ localStorageTheme, systemSettingDark }) {
  if (localStorageTheme !== null) {
    return localStorageTheme;
  }
  if (systemSettingDark.matches) {
    return "dark";
  }
  return "light";
}

// Get system preference + saved theme
const localStorageTheme = localStorage.getItem("theme");
const systemSettingDark = window.matchMedia("(prefers-color-scheme: dark)");

let currentThemeSetting = calculateSettingAsThemeString({ localStorageTheme, systemSettingDark });

// Apply initial theme
document.querySelector("html").setAttribute("data-theme", currentThemeSetting);

// Update button text
const button = document.querySelector("[data-theme-toggle]");
button.innerText = currentThemeSetting === "dark" ? "turn on background gif" : "turn off background gif";
button.setAttribute("aria-label", button.innerText);

// Handle click
button.addEventListener("click", () => {
  const newTheme = currentThemeSetting === "dark" ? "light" : "dark";

  const newCta = newTheme === "dark" ? "turn on background gif" : "turn off background gif";
  button.innerText = newCta;
  button.setAttribute("aria-label", newCta);

  document.querySelector("html").setAttribute("data-theme", newTheme);
  localStorage.setItem("theme", newTheme);
  currentThemeSetting = newTheme;
});


</script>
</body>
</html>
